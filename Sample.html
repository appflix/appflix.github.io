
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <style>
        body {
          
            font-family: 'Roboto', sans-serif;
            background-color: #e7e6fb;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            flex-direction: column; /* "Adjustment for column orientation" */
            align-items: center; /* Center the forms horizontally */
        }

        .form-container {
            max-width: 600px;
            width: 100%;
            background-color: #fff;
            border: 1px solid #dadce0;
            border-top: 8px solid #003cff; /* Added: Violet top border. */
            border-radius: 8px;
            box-shadow: 0px 3px 8px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            padding: 22px;
            margin-bottom: 20px; /* Adjustment to add space between forms */


        }

        .form-container2 {
            max-width: 600px;
            width: 100%;
            background-color: #fff;
            border: 1px solid #dadce0;
            border-radius: 8px;
            box-shadow: 0px 3px 8px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            padding: 32px;
            margin-bottom: 20px; /* Adjustment to add space between forms. */
        }

        .form-container3 {
            max-width: 600px;
            width: 100%;
          
          
          
            box-sizing: border-box;
            padding: 0px;
            margin-bottom: 20px; /* Adjustment to add space between forms. */
        }

        .question-container {
            margin-bottom: 32px;
        }

        .title {
            font-size: 32px;
            font-weight: bold;
            color: #202124;
            margin-bottom: 12px;
        }
                .subtitle {
            font-size: 14px;
            font-weight: bold;
            color: #202124;
            margin-bottom: 12px;
        }
        
                    .warning {
            font-size: 14px;
            font-weight: bold;
            color: red;
            margin-bottom: 12px;
        }

        .question {
            font-size: 18px;
            font-weight: bold;
            color: #202124;
            margin-bottom: 12px;
        }

        .input-container {
            margin-bottom: 24px;
        }

        input {
            width: calc(100% - 24px);
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 16px;
            margin-top: 4px;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: #673ab7;
            outline: none;
        }

        button {
            background-color: #003cff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #311b92;
        }
     


  
canvas {
  width: 100%;               /* Escala visualmente al contenedor */
  height: auto;
  aspect-ratio: 5 / 3;       /* Mantiene proporci√≥n de firma */
  border: 3px solid black;
  touch-action: none;
  display: block;
    touch-action: none; /* üîí evita el scroll o pinch sobre el canvas */
}

    input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.radio-group {
  display: flex;
  flex-direction: column;
  gap: 1px;
  margin-top: 16px;
  font-size: 16px;
}

.radio-group input[type="radio"] {
  width: 18px;
  height: 18px;
  margin-right: 8px;
  vertical-align: middle;
  cursor: pointer;
}

#loadingOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(255, 255, 255, 0.8);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

.spinner {
  border: 6px solid #ccc;
  border-top: 6px solid #003cff;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  animation: spin 1s linear infinite;
}

.loading-text {
  margin-top: 16px;
  font-size: 18px;
  font-weight: bold;
  color: #003cff;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#submit {
  margin-bottom: 2rem; /* o el valor que prefieras */
}

    </style>
</head>
<body >


    <img id="-1" class="form-container2" src="https://i.postimg.cc/Xqt3RfFh/Banner.jpg" alt="" style="display: none;" >

   
    <div id="0" class="form-container" style="display: none;" >
        <div class="question-container">
            <div class="title" id="title">TEXT MESSAGING SERVICE AGREEMENT</div>
             <div id="e">

            

    <p><strong>Patient Focused Neurology</strong> offers an optional SMS messaging service to help you manage your care. <strong>By enrolling, you agree to receive text messages regarding:</strong></p>

    <ul>
        <li>Appointment confirmations and reminders</li>
        <li>Pre-visit instructions and check-in notices</li>
        <li>Insurance and demographic requests</li>
        <li>Billing and payment reminders</li>
        <li>Follow-up care or missed appointments</li>
    </ul>

    <p><strong>Consent & Privacy:</strong> We will not send you text messages without your explicit consent. Your mobile number and SMS consent will not be shared with any third parties or affiliates for marketing purposes. Messages are not encrypted, and anyone with access to your phone or mobile service may be able to view them.</p>

    <p><strong>Message Frequency & Fees:</strong> Message frequency may vary depending on your care needs. You may receive up to 2‚Äì4 messages per week. Message and data rates may apply based on your mobile plan.</p>

</div>

<div class="subtitle" id="ty" style="display: none;">
    Your response has been recorded
    <br><br>
    <button onclick="reloadApp();" style="background: none; color: blue; border: none; text-decoration: underline; cursor: pointer; padding: 0;">
        Back to Form
    </button>
</div>

        </div>

    </div>





<div id="consent" class="form-container2" style="display: none;">
  <div class="question-container">
    <p style="font-weight: bold;">
      I consent to receive text messages from PFN. I understand this is optional and that I can reply STOP at any time to unsubscribe.
    </p>

    <div class="radio-group">
      <label>
        <input type="radio" id="consentYes" name="smsConsent" value="yes"> Yes
      </label><br>
      <label>
        <input type="radio" id="consentNo" name="smsConsent" value="no"> No
      </label>
    </div>
  </div>

  <div class="warning" id="warningConsent" style="display: none; color: red; margin-top: 8px;">
    You must check the box to continue.
  </div>
</div>






    <div id="1" class="form-container2" style="display: none;">
        <div class="question-container">
            <div class="question">Patient's Name (last, first):</div>
            
        </div>

        <div class="input-container">
            <input type="text" id="username" name="username" placeholder="Enter your name">
        </div>

        <div class="warning" id="warning"style="display: none;">This is a required field</div>

 
    </div>




    <div id="b" class="form-container2" style="display: none;">
        <div class="question-container">
            <div class="question">Patient's date of birth:</div>
            
        </div>

        <div class="input-container">
            <input type="date" id="dateBirth" name="dateBirth" placeholder="Enter your date of birth">
        </div>

        <div class="warning" id="warning2"style="display: none;">This is a required field</div>

 
    </div>

    <div id="c" class="form-container2" style="display: none;">
        <div class="question-container">
            <div class="question">Mobile number 1: (XXX-XXX-XXXX)</div>
            
        </div>

        <div class="input-container">
            <input type="text" id="mobile" name="mobile" placeholder="Enter your Mobile number">
        </div>

        <div class="warning" id="warning3"style="display: none;">This is a required field</div>

 
    </div>



    <div id="mobile2" class="form-container2" style="display: none;">
        <div class="question-container">
            <div class="question">Mobile number 2: (XXX-XXX-XXXX)</div>
            
        </div>

        <div class="input-container">
            <input type="text" id="mobile2Input" name="mobile2" placeholder="Enter a second Mobile number (optional)">

        </div>

        <div class="warning" id="warning3"style="display: none;">This is a required field</div>

 
    </div>






    <div id="2" class="form-container2" style="display: none;">
        <div class="question-container">
      <p>
      <strong><u>By signing  the box below</u></strong>, you consent to receive SMS messages from Patient Focused Neurology regarding appointment reminders and confirmations, insurance information requests, billing reminders, missed appointment follow-ups, and insurance inactivity.
    </p>

    <p>
      You may opt out at any time by replying ‚ÄúSTOP.‚Äù Message and data rates may apply. Message frequency may vary. For assistance, text HELP to 805-579-9990.
      For more information, please review our Privacy Policy at
      <a href="https://www.pfneurology.com/privacy-policy" target="_blank" rel="noopener noreferrer">www.pfneurology.com/privacy-policy</a>.
    </p>
            <div id="question" class="question">

            </div>
        </div>
    
<input id="file" type="file"  style="display: none;"/>
        <canvas id="sign"></canvas>
          <br>
          <br>

        <button type="button" id="clearButton">Erase</button>
 <div class="warning" id="warning4"style="display: none;">This is a required field</div>

    </div>

    <div id="f" class="form-container2" style="display: none;">
        <div class="question-container">
            <div class="question">Date of signing</div>
            
        </div>

        <div class="input-container">
            <input type="date" id="DateOfSigning" name="DateOfSigning" placeholder="Enter today's date">
        </div>

        <div class="warning" id="warning5"style="display: none;">This is a required field</div>

 
    </div>





    <div class="form-container3">

        <button type="button" id="submit" onclick="send()" style="display: none;">Submit</button>
    </div>

   
<div id="loadingOverlay" style="display: none;">
  <div class="overlay-content">
    <div class="spinner"></div>
    <div class="loading-text">Sending...</div>
  </div>
</div>
   

<script>
function reloadApp() {
  location.reload(); // recarga la misma p√°gina
}

const visibleIds = ["-1", "0", "1", "b", "c", "2", "f", "mobile2", "consent", "submit"];
visibleIds.forEach(id => {
  const el = document.getElementById(id);
  if (el) el.style.display = "block";
});

var canvas = document.querySelector('canvas');
var clearButton = document.getElementById('clearButton');
var fileInput = document.getElementById('file');
var ctx = canvas.getContext('2d');

let signatureCaptured = false;

canvas.addEventListener('mousedown', () => signatureCaptured = true);
canvas.addEventListener('touchstart', () => signatureCaptured = true);

// Evitar resize si ya hay firma
function resizeCanvas() {
  if (signatureCaptured) return;

  const width = canvas.offsetWidth;
  const height = width * 0.6;
  canvas.width = width;
  canvas.height = height;
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas(); // inicial

var pos = { x: 0, y: 0 };
var drawing = false;

// üñ± Eventos rat√≥n
canvas.addEventListener('mousedown', (e) => {
  drawing = true;
  setPosition(e);
});
canvas.addEventListener('mouseup', () => drawing = false);
canvas.addEventListener('mousemove', draw);

// üì± Eventos t√°ctiles (iPhone / iPad)
canvas.addEventListener('touchstart', (e) => {
  e.preventDefault();
  drawing = true;
  setPosition(e);
}, { passive: false });

canvas.addEventListener('touchend', () => {
  drawing = false;
}, { passive: false });

canvas.addEventListener('touchmove', (e) => {
  e.preventDefault();
  if (!drawing) return;
  draw(e);
}, { passive: false });

clearButton.addEventListener('click', clearCanvas);

function setPosition(e) {
  var rect = canvas.getBoundingClientRect();
  if (e.touches) {
    pos.x = e.touches[0].clientX - rect.left;
    pos.y = e.touches[0].clientY - rect.top;
  } else {
    pos.x = e.clientX - rect.left;
    pos.y = e.clientY - rect.top;
  }
}

function draw(e) {
  if (!drawing && !e.touches) return;

  ctx.beginPath();
  ctx.lineWidth = 5;
  ctx.lineCap = 'round';
  ctx.strokeStyle = 'black';

  ctx.moveTo(pos.x, pos.y);
  setPosition(e);
  ctx.lineTo(pos.x, pos.y);
  ctx.stroke();
}

function clearCanvas() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function saveFile(f, cual) {
  let name = document.getElementById("username").value;
  const file = f.files[0];
  const fr = new FileReader();

  fr.onload = function(e) {
    const obj = {
      filename: cual + " " + name,
      mimeType: file.type,
      bytes: [...new Int8Array(e.target.result)]
    };
    google.script.run.withSuccessHandler(data => {
      // Opcional: manejar respuesta
    }).saveFile(obj, name);
  }

  fr.readAsArrayBuffer(file);
  return cual;
}

async function send() {
  const submitBtn = document.getElementById("submit");
  const overlay = document.getElementById("loadingOverlay");

  submitBtn.disabled = true;
  overlay.style.display = "flex";

  const name = document.getElementById("username").value;
  const birth = document.getElementById("dateBirth").value;
  const mobile = document.getElementById("mobile").value;
  const mobile2 = document.getElementById("mobile2Input").value;
  const timestamp = document.getElementById("DateOfSigning").value;

  let hasError = false;
  let firstErrorElement = null;

  if (!name) {
    document.getElementById("1").style.borderColor = "red";
    document.getElementById("warning").style.display = "block";
    hasError = true;
    if (!firstErrorElement) firstErrorElement = document.getElementById("1");
  } else {
    document.getElementById("1").style.borderColor = "";
    document.getElementById("warning").style.display = "none";
  }

  if (!birth) {
    document.getElementById("b").style.borderColor = "red";
    document.getElementById("warning2").style.display = "block";
    hasError = true;
    if (!firstErrorElement) firstErrorElement = document.getElementById("b");
  } else {
    document.getElementById("b").style.borderColor = "";
    document.getElementById("warning2").style.display = "none";
  }

  if (!mobile) {
    document.getElementById("c").style.borderColor = "red";
    document.getElementById("warning3").style.display = "block";
    hasError = true;
    if (!firstErrorElement) firstErrorElement = document.getElementById("c");
  } else {
    document.getElementById("c").style.borderColor = "";
    document.getElementById("warning3").style.display = "none";
  }

  if (!timestamp) {
    document.getElementById("f").style.borderColor = "red";
    document.getElementById("warning5").style.display = "block";
    hasError = true;
    if (!firstErrorElement) firstErrorElement = document.getElementById("f");
  } else {
    document.getElementById("f").style.borderColor = "";
    document.getElementById("warning5").style.display = "none";
  }

  const consentYes = document.getElementById("consentYes").checked;
  const consentNo = document.getElementById("consentNo").checked;

  if (!consentYes && !consentNo) {
    document.getElementById("consent").style.borderColor = "red";
    document.getElementById("warningConsent").style.display = "block";
    hasError = true;
    if (!firstErrorElement) firstErrorElement = document.getElementById("consent");
  } else {
    document.getElementById("consent").style.borderColor = "";
    document.getElementById("warningConsent").style.display = "none";
  }

  const consentValue = consentYes ? "Yes" : "No";

  const canvas = document.getElementById("sign");
  const ctx = canvas.getContext("2d");
  const isCanvasEmpty = ctx.getImageData(0, 0, canvas.width, canvas.height).data.every(value => value === 0);

  if (isCanvasEmpty) {
    document.getElementById("2").style.borderColor = "red";
    document.getElementById("warning4").style.display = "block";
    hasError = true;
    if (!firstErrorElement) firstErrorElement = document.getElementById("2");
  } else {
    document.getElementById("2").style.borderColor = "";
    document.getElementById("warning4").style.display = "none";
  }

  if (hasError) {
    if (firstErrorElement) {
      firstErrorElement.scrollIntoView({ behavior: "smooth", block: "center" });
    }
    submitBtn.disabled = false;
    overlay.style.display = "none";
    return;
  }

  const signatureBase64 = canvas.toDataURL("image/png").split(',')[1];

  const payload = {
    name,
    birth,
    mobile,
    mobile2,
    timestamp,
    consent: consentValue,
    signature: {
      filename: `signature_${name}.png`,
      mimeType: "image/png",
      data: signatureBase64
    }
  };

  try {
    await fetch("https://script.google.com/macros/s/AKfycby_Ibp88On1zIXiTDqMOAWyc2PFzI9WqFdTz-_r1CizPFTy251JYaELH3TtAR0oR_p5yw/exec", {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify(payload)
    });

    const hideIds = ["1", "b", "c", "e", "2", "f", "mobile2", "consent", "submit"];
    hideIds.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = "none";
    });

    document.getElementById("ty").style.display = "block";
    overlay.style.display = "none";
  } catch (err) {
    console.error("Error al enviar datos:", err);
   
    submitBtn.disabled = false;
    overlay.style.display = "none";
  }
}
</script>


</body>
</html>
